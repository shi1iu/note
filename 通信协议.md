## é€šä¿¡æ€»çº¿çš„åˆ†ç±»



## ä¸€ã€é€šä¿¡åˆ†ç±»



### ï¼ˆä¸€ï¼‰ä¸²è¡Œé€šä¿¡

- å·¥ä½œæ–¹å¼ï¼š åœ¨ä¸²è¡Œé€šä¿¡ä¸­ï¼Œæ•°æ®ä½æŒ‰ç…§é¡ºåºä¾æ¬¡ä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€ä½æ•°æ®éƒ½ä¾æ¬¡å‘é€æˆ–æ¥æ”¶ã€‚
- ä¼˜ç‚¹ï¼š ç›¸å¯¹ç®€å•ï¼Œä¸å®¹æ˜“å‡ºç°æ•°æ®å†²çªã€‚ç”±äºåªæœ‰ä¸€ä¸ªé€šä¿¡é€šé“ï¼Œçº¿è·¯çš„å¸ƒçº¿è¾ƒä¸ºç®€å•ã€‚
- ç¼ºç‚¹ï¼š é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œå› ä¸ºæ¯æ¬¡åªèƒ½ä¼ è¾“ä¸€ä¸ªä½ã€‚ä¸é€‚åˆå¤§é‡æ•°æ®çš„å¿«é€Ÿä¼ è¾“ã€‚
- å…¸å‹åº”ç”¨ï¼šUSBï¼ŒUARTï¼Œå…‰çº¤é€šä¿¡ã€‚

### ï¼ˆäºŒï¼‰å¹¶è¡Œé€šä¿¡

- å·¥ä½œæ–¹å¼ï¼š åœ¨å¹¶è¡Œé€šä¿¡ä¸­ï¼Œå¤šä¸ªæ•°æ®ä½åŒæ—¶ä¼ è¾“ã€‚æ¯ä¸ªä½éƒ½æœ‰è‡ªå·±çš„é€šé“ï¼Œå¯ä»¥ç‹¬ç«‹ä¼ è¾“ï¼Œä»è€Œåœ¨åŒä¸€æ—¶åˆ»ä¼ è¾“å¤šä¸ªä½ã€‚
- ä¼˜ç‚¹ï¼š é€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ï¼Œå°¤å…¶é€‚åˆå¤§é‡æ•°æ®çš„å¿«é€Ÿä¼ è¾“ã€‚é€‚ç”¨äºéœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªæ•°æ®ä½çš„æƒ…å†µã€‚
- ç¼ºç‚¹ï¼š å¤æ‚åº¦è¾ƒé«˜ï¼Œå ç”¨å¼•è„šèµ„æºå¤šã€‚å®¹æ˜“å‡ºç°æ•°æ®åŒæ­¥é—®é¢˜ã€‚
- å…¸å‹åº”ç”¨ï¼šé€‚ç”¨äºçŸ­è·ç¦»ä¼ è¾“ï¼Œé•¿è·ç¦»ä¼ è¾“æˆæœ¬é«˜ã€‚

### ï¼ˆä¸‰ï¼‰åŒæ­¥é€šä¿¡

- å·¥ä½œæ–¹å¼ï¼š åœ¨åŒæ­¥é€šä¿¡ä¸­ï¼Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶æ˜¯åœ¨é¢„å®šçš„æ—¶é’Ÿä¿¡å·ä¸‹è¿›è¡Œçš„ã€‚æ•°æ®çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹éœ€è¦å…±äº«ç›¸åŒçš„æ—¶é’Ÿæºï¼Œä»¥ç¡®ä¿æ•°æ®çš„åŒæ­¥ã€‚
- ä¼˜ç‚¹ï¼š æ•°æ®ä¼ è¾“çš„æ—¶åºæ¸…æ™°ï¼Œæ˜“äºç®¡ç†å’Œç†è§£ã€‚é€‚ç”¨äºéœ€è¦å®æ—¶æ€§å’Œç²¾ç¡®åŒæ­¥çš„åº”ç”¨ã€‚
- ç¼ºç‚¹ï¼š é«˜é¢‘æ—¶é’Ÿè¡°å‡è¾ƒå¿«ï¼Œé€šä¿¡è¿‡ç¨‹æ˜“å‘ç”Ÿä¿¡å·ç•¸å˜ï¼Œç›¸ä½åç§»ï¼Œå› æ­¤ä¼ è¾“è·ç¦»ä¸å®œè¿‡é•¿ã€‚
- å…¸å‹åº”ç”¨ï¼šI2Cï¼ŒHDMIï¼ŒCPUä¸å†…å­˜æ¥å£ç­‰ã€‚

### ï¼ˆå››ï¼‰å¼‚æ­¥é€šä¿¡

- å·¥ä½œæ–¹å¼ï¼š åœ¨å¼‚æ­¥é€šä¿¡ä¸­ï¼Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ä¸ä¾èµ–äºå…±äº«æ—¶é’Ÿä¿¡å·ã€‚æ¯ä¸ªæ•°æ®å—ä¹‹é—´æœ‰ä¸€å®šçš„é—´éš”ï¼Œè€Œä¸éœ€è¦ä¸¥æ ¼çš„æ—¶åºåŒæ­¥ã€‚é€šä¿¡è®¾å¤‡ä¼šä½¿ç”¨èµ·å§‹ä½å’Œåœæ­¢ä½æ¥æ ‡è¯†æ•°æ®å—çš„å¼€å§‹å’Œç»“æŸã€‚
- ä¼˜ç‚¹ï¼š è¾ƒä¸ºçµæ´»ï¼Œä¸éœ€è¦ç²¾ç¡®çš„æ—¶é’ŸåŒæ­¥ã€‚ä¼ è¾“åª’ä»‹ç®€å•ï¼Œä¼ è¾“è·ç¦»é•¿ã€‚
- ç¼ºç‚¹ï¼š åœ¨é«˜é€Ÿä¼ è¾“å’Œé•¿è·ç¦»é€šä¿¡æ—¶ï¼Œç”±äºæ²¡æœ‰åŒæ­¥çš„æ—¶é’Ÿï¼Œå¯èƒ½ä¼šå‡ºç°æ•°æ®å¤±çœŸã€‚æ¥æ”¶ç«¯è§£ç å¤æ‚æ€§å¢åŠ ï¼Œå¯é æ€§é™ä½ã€‚
- å…¸å‹åº”ç”¨ï¼šUARTï¼ŒUSB1.1ï¼ŒUSB2.0ï¼Œå…‰çº¤é€šä¿¡ã€‚

### ï¼ˆäº”ï¼‰å•å·¥é€šä¿¡

- å®šä¹‰ï¼š å•å·¥é€šä¿¡æ˜¯ä¸€ç§å•å‘é€šä¿¡æ¨¡å¼ï¼Œæ•°æ®åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šä¼ è¾“ã€‚é€šå¸¸ï¼Œä¸€ä¸ªè®¾å¤‡æ˜¯å‘é€è€…ï¼Œè€Œå¦ä¸€ä¸ªè®¾å¤‡æ˜¯æ¥æ”¶è€…ã€‚
- ç‰¹ç‚¹ï¼š é€šä¿¡åŒæ–¹åªèƒ½åœ¨ä¸€ä¸ªç‰¹å®šçš„æ–¹å‘ä¸Šä¼ è¾“ä¿¡æ¯ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾å¤‡åªèƒ½å‘é€ï¼Œè€Œå¦ä¸€ä¸ªåªèƒ½æ¥æ”¶ã€‚
- ä¾‹å­ï¼š æ— çº¿ç”µå¹¿æ’­ã€ç”µè§†å¹¿æ’­ç­‰ã€‚

### ï¼ˆå…­ï¼‰åŠåŒå·¥é€šä¿¡

- å®šä¹‰ï¼š åŠåŒå·¥é€šä¿¡æ˜¯ä¸€ç§åŒå‘é€šä¿¡æ¨¡å¼ï¼Œä½†æ˜¯é€šä¿¡åŒæ–¹ä¸èƒ½åŒæ—¶è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œä¸€ä¸ªè®¾å¤‡å¯ä»¥å‘é€ï¼Œè€Œå¦ä¸€ä¸ªè®¾å¤‡å¯ä»¥æ¥æ”¶ï¼Œä½†ä¸èƒ½åŒæ—¶è¿›è¡Œã€‚
- ç‰¹ç‚¹ï¼š æ•°æ®ä¼ è¾“æ˜¯åŒå‘çš„ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶å‘ç”Ÿï¼Œéœ€è¦åœ¨å‘é€å’Œæ¥æ”¶ä¹‹é—´åˆ‡æ¢ã€‚
- ä¾‹å­ï¼š å¯¹è®²æœºã€ä¼ ç»Ÿçš„æ— çº¿ç”µé€šä¿¡ç­‰ã€‚

### ï¼ˆä¸ƒï¼‰å…¨åŒå·¥é€šä¿¡

- å®šä¹‰ï¼š å…¨åŒå·¥é€šä¿¡æ˜¯ä¸€ç§åŒå‘é€šä¿¡æ¨¡å¼ï¼Œå…¶ä¸­é€šä¿¡çš„åŒæ–¹èƒ½å¤ŸåŒæ—¶è¿›è¡Œå‘é€å’Œæ¥æ”¶æ“ä½œï¼Œå…è®¸åŒæ–¹åŒæ—¶ä¼ è¾“æ•°æ®ã€‚
- ç‰¹ç‚¹ï¼š åŒæ–¹å¯ä»¥åœ¨åŒä¸€æ—¶é—´å†…åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œå®ç°çœŸæ­£çš„åŒå‘é€šä¿¡ã€‚
- ä¾‹å­ï¼š ç”µè¯é€šè¯ã€äº’è”ç½‘è¯­éŸ³é€šè¯ã€å…¸å‹çš„è®¡ç®—æœºç½‘ç»œé€šä¿¡ç­‰ã€‚



![img](./assets/5030c66e58a09efe2fe253c00b90f42b.png)



### 1.UART

> é€šç”¨å¼‚æ­¥æ”¶å‘å™¨

å‚è€ƒèµ„æ–™[UARTä¸²å£é€šä¿¡](https://blog.csdn.net/m0_58427556/article/details/135302591?ops_request_misc=%257B%2522request%255Fid%2522%253A%25229ce9c4c971358bbd60f0faf97c3965c6%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=9ce9c4c971358bbd60f0faf97c3965c6&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~top_positive~default-1-135302591-null-null.nonecase&utm_term=uart%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1&spm=1018.2226.3001.4450)ã€‚

#### 1.1 æ¯”ç‰¹ç‡å’Œæ³¢ç‰¹ç‡

- æ¯”ç‰¹ç‡å•ä½bps(bit per second)ï¼Œæ¯ç§’é’Ÿä¼ é€çš„bitçš„æ•°é‡ã€‚
- æ³¢ç‰¹ç‡å•ä½Bandï¼Œæ¯ç§’é’Ÿä¼ è¾“ç å…ƒçš„ä¸ªæ•°ã€‚

#### 1.2ç”µæ°”è¿æ¥

![img](./assets/dac16f59003e0133da62f5d8201be63a.png)

#### 1.3æ•°æ®å¸§

![image-20250321111735483](./assets/a-1752476966420-7.png)

- â€‹    ç©ºé—²ä½ï¼šçº¿è·¯ä¸Šä¸ºé«˜ç”µå¹³ï¼Œå³é€»è¾‘å€¼ä¸º1ã€‚
- â€‹    èµ·å§‹ä½ï¼šé€»è¾‘å€¼ä¸º0æ—¶ï¼Œè¡¨ç¤ºå­—ç¬¦å¸§çš„å¼€å§‹ã€‚
- â€‹    æ•°æ®ä½ï¼šå…ˆå‘ä½ä½å†å‘é«˜ä½ã€‚
- â€‹    æ ¡éªŒä½ï¼šå¥‡å¶æ ¡éªŒã€‚
- â€‹    åœæ­¢ä½ï¼šé«˜ç”µå¹³ä»£è¡¨ä¸€ä¸ªå­—ç¬¦å¸§ç»“æŸã€‚



### 2.IIC

> IIC åè®®ï¼ˆ***Inter-Integrated Circuit***ï¼Œå¯ç®€å†™ä¸º ***I2C***ï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨äºå„ç§ç”µå­è®¾å¤‡ä¹‹é—´è¿›è¡Œé€šä¿¡å’Œæ•°æ®äº¤æ¢çš„ä¸²è¡Œé€šä¿¡åè®®ã€‚å®ƒæ˜¯ç”±é£åˆ©æµ¦ï¼ˆPhilipsï¼‰å…¬å¸äº 1982 å¹´é¦–æ¬¡æå‡ºå¹¶æ¨å¹¿çš„ä¸€ç§ç®€å•ã€é«˜æ•ˆã€ä½æˆæœ¬çš„é€šä¿¡åè®®ã€‚

#### 2.1å•ä¸ª/å¤šä¸ªå­—èŠ‚çš„å†™å…¥/è¯»å–

![img](./assets/ab98eff9a1cf446abfca5509443b7d07.png)

**å†™å…¥å•ä¸ªå­—èŠ‚**
â€ƒâ€ƒå‘ä»æœºè®¾å¤‡çš„æŸä¸€ä¸ªå¯„å­˜å™¨å†™ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼šå¼€å§‹ä¿¡å·+è®¾å¤‡åœ°å€(7ä½)+è¯»/å†™(1ä½)+ç­‰å¾…ä»æœºåº”ç­”+å¯„å­˜å™¨åœ°å€(8ä½)+ç­‰å¾…ä»æœºåº”ç­”+è¦å†™çš„æ•°æ®(8ä½)+ç­‰å¾…ä»æœºåº”ç­”+ç»ˆæ­¢ä¿¡å·ã€‚

**å†™å…¥å¤šä¸ªå­—èŠ‚**
â€ƒâ€ƒå‘ä»æœºè®¾å¤‡çš„æŸä¸€ä¸ªå¯„å­˜å™¨å†™å¤šä¸ªå­—èŠ‚æ•°æ®ï¼šå¼€å§‹ä¿¡å·+è®¾å¤‡åœ°å€(7ä½)+è¯»/å†™(1ä½)+ç­‰å¾…ä»æœºåº”ç­”+å¯„å­˜å™¨åœ°å€(8ä½)+ç­‰å¾…ä»æœºåº”ç­”+è¦å†™çš„æ•°æ®_1(8ä½)+ç­‰å¾…ä»æœºåº”ç­”+è¦å†™çš„æ•°æ®_2(8ä½)+ç­‰å¾…ä»æœºåº”ç­”+Â·Â·Â·Â·Â·Â·+è¦å†™çš„æ•°æ®_N(8ä½)+ç­‰å¾…ä»æœºåº”ç­”+ç»ˆæ­¢ä¿¡å·ã€‚

**è¯»å–ä¸€ä¸ªå­—èŠ‚**
â€ƒâ€ƒä»æœºè®¾å¤‡çš„æŸä¸€ä¸ªå¯„å­˜å™¨è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼šå¼€å§‹ä¿¡å·+è®¾å¤‡åœ°å€(7ä½)+å†™(1ä½)+ç­‰å¾…ä»æœºåº”ç­”+æ•°æ®åœ°å€(8ä½)+ç­‰å¾…ä»æœºåº”ç­”+å¼€å§‹ä¿¡å·+è®¾å¤‡åœ°å€(7ä½)+è¯»(1ä½)+ç­‰å¾…ä»æœºåº”ç­”+ä»æœºè¿”å›è¯»å–æ•°æ®_1(8ä½)+ä¸»æœº(æ¥æ”¶æœº)ä¸å†åº”ç­”+ç»ˆæ­¢ä¿¡å·

**è¯»å–å¤šä¸ªå­—èŠ‚**
â€ƒâ€ƒä»ä»æœºè®¾å¤‡çš„æŸä¸€ä¸ªå¯„å­˜å™¨è¯»å–å¤šä¸ªå­—èŠ‚æ•°æ®ï¼šå¼€å§‹ä¿¡å·+è®¾å¤‡åœ°å€(7ä½)+å†™(1ä½)+ç­‰å¾…ä»æœºåº”ç­”+æ•°æ®åœ°å€(8ä½)+ç­‰å¾…ä»æœºåº”ç­”+å¼€å§‹ä¿¡å·+è®¾å¤‡åœ°å€(7ä½)+è¯»(1ä½)+ç­‰å¾…ä»æœºåº”ç­”+ä»æœºè¿”å›è¯»å–æ•°æ®_1(8ä½)+ä¸»æœº(æ¥æ”¶æœº)åº”ç­”+ä»æœºè¿”å›è¯»å–æ•°æ®_2(8ä½)+ä¸»æœº(æ¥æ”¶æœº)åº”ç­”+......+ä»æœºè¿”å›è¯»å–æ•°æ®_N(8ä½)+ä¸»æœº(æ¥æ”¶æœº)ä¸å†åº”ç­”+ç»ˆæ­¢ä¿¡å·ã€‚

### 3. SPI

> SPI (Serial Peripheral interface)ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä¸²è¡Œå¤–å›´è®¾å¤‡æ¥å£ã€‚æ˜¯Motorola(æ‘©æ‰˜ç½—æ‹‰)é¦–å…ˆåœ¨å…¶MC68HCXXç³»åˆ—å¤„ç†å™¨ä¸Šå®šä¹‰çš„ã€‚
>
> SPIï¼Œæ˜¯ä¸€ç§é«˜é€Ÿçš„ï¼Œå…¨åŒå·¥ï¼ŒåŒæ­¥çš„é€šä¿¡æ€»çº¿ï¼Œå¹¶ä¸”åœ¨èŠ¯ç‰‡çš„ç®¡è„šä¸Šåªå ç”¨å››æ ¹çº¿ï¼ŒèŠ‚çº¦äº†èŠ¯ç‰‡çš„ç®¡è„šï¼ŒåŒæ—¶ä¸ºPCBçš„å¸ƒå±€ä¸ŠèŠ‚çœç©ºé—´ï¼Œæä¾›æ–¹ä¾¿ï¼Œä¸»è¦åº”ç”¨åœ¨ EEPROMï¼ŒFLASHï¼Œå®æ—¶æ—¶é’Ÿï¼ŒADè½¬æ¢å™¨ï¼Œè¿˜æœ‰æ•°å­—ä¿¡å·å¤„ç†å™¨å’Œæ•°å­—ä¿¡å·è§£ç å™¨ä¹‹é—´ã€‚



### 4.CAN



[ä¸€æ–‡è¯»æ‡‚CANæ€»çº¿åè®® (è¶…è¯¦ç»†é…34å¼ é«˜æ¸…å›¾)](https://blog.csdn.net/qq_35057766/article/details/135580884)

### 5.USB

### 6.GPIO

### 7.WIFI

### 8.SDIO

### 9.Ethernet

[åµŒå…¥å¼ç½‘ç»œæ¥å£è®¾è®¡](https://blog.csdn.net/u010783226/article/details/131633603?ops_request_misc=&request_id=&biz_id=102&utm_term=%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%BD%91%E5%8F%A3%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-131633603.142^v102^pc_search_result_base7&spm=1018.2226.3001.4187)

### 10.TCP/IPåè®®

**ä¸‰æ¬¡æ¡æ‰‹**

![image-20250712105624714](./assets/image-20250712105624714.png)

**å››æ¬¡æŒ¥æ‰‹**

![image-20250712105706926](./assets/image-20250712105706926.png)

![image-20250712112308900](./assets/image-20250712112308900.png)

**ä¸ºä»€ä¹ˆé€šè¿‡wiresharkæŠ“åŒ…ä¸‰æ¬¡æŒ¥æ‰‹æŠ“åˆ°3åŒ…ï¼Ÿ**

![image-20250712111829875](./assets/image-20250712111829875.png)

Finç¬¬ä¸€ä¸ªåŒ…ï¼šé¦–ä¸ªæŒ¥æ‰‹åŒ…æœ¬ç«¯å‘Šè¯‰å¯¹ç«¯çš„FINå’Œæœ¬ç«¯å‘Šè¯‰å¯¹ç«¯çš„ACKåˆå¹¶åœ¨äº†ä¸€èµ·
åœ¨TCPè¿æ¥ä¸­ï¼Œå…³é—­è¿æ¥é€šå¸¸æ˜¯ç”±å…¶ä¸­ä¸€æ–¹å‘èµ·çš„ã€‚å½“ä¸€æ–¹å†³å®šå…³é—­è¿æ¥æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªå¸¦æœ‰FINæ ‡å¿—çš„TCPæŠ¥æ–‡ï¼Œè¡¨ç¤ºå®ƒå·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œå¹¶è¯·æ±‚å…³é—­è¿æ¥ã€‚ä½†æ˜¯ï¼Œç”±äºTCPæ˜¯å¯é ä¼ è¾“åè®®ï¼Œå®ƒéœ€è¦ç¡®ä¿å‘é€çš„æŠ¥æ–‡èƒ½å¤Ÿè¢«å¯¹æ–¹æ­£ç¡®æ¥æ”¶ã€‚å› æ­¤ï¼Œåœ¨å‘é€FINæ ‡å¿—çš„åŒæ—¶ï¼Œä¹Ÿéœ€è¦å‘é€ACKæ ‡å¿—ï¼Œè¡¨ç¤ºå®ƒå·²ç»ç¡®è®¤æ¥æ”¶åˆ°å¯¹æ–¹å‘é€çš„æ•°æ®ï¼Œå¹¶ä¸”å·²ç»å‡†å¤‡å¥½å…³é—­è¿æ¥ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡æŒ¥æ‰‹å‘é€çš„TCPæŠ¥æ–‡ä¸­å¸¦æœ‰FINå’ŒACKæ ‡å¿—çš„åŸå› ã€‚åªä¸è¿‡åœ¨å®é™…åŠå¤§å¤šæ•°äººçš„ç†è®ºä¸­ç»å¸¸å¿½ç•¥è¿™ä¸ªACKåŒ…
Finç¬¬äºŒä¸ªåŒ…ï¼š**å¯¹ç«¯çš„FINå’Œå¯¹ç«¯å›å¤æœ¬ç«¯FINçš„ACKåˆå¹¶åœ¨ä¸€èµ·**
Finç¬¬ä¸‰ä¸ªåŒ…ï¼šæœ¬ç«¯å›å¤å¯¹ç«¯çš„FINçš„ACK

linuxä¸‹è·‘ä¾‹ç¨‹ï¼Œwindowsä½¿ç”¨ä¸²å£è°ƒè¯•åŠ©æ‰‹

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <pthread.h>
#include <semaphore.h>
#include <netinet/in.h>
#include <arpa/inet.h>

#define PORT 8888
#define BUFFER_SIZE 10
#define MAX_MSG_LEN 1024
#define MAX_CLIENTS 5

// ç¼“å†²åŒºç»“æ„
char message_buffer[BUFFER_SIZE][MAX_MSG_LEN];
int in = 0, out = 0;

// åŒæ­¥æœºåˆ¶
pthread_mutex_t mutex;
sem_t full_slots, empty_slots;

// ç½‘ç»œæ¥æ”¶çº¿ç¨‹ï¼ˆç”Ÿäº§è€…ï¼‰
void* client_handler(void* arg) {
    int client_fd = *(int*)arg;
    free(arg);
    char recv_buf[MAX_MSG_LEN];

    while (1) {
        int bytes = recv(client_fd, recv_buf, sizeof(recv_buf) - 1, 0);
        if (bytes <= 0) {
            printf("ğŸ”Œ å®¢æˆ·ç«¯æ–­å¼€è¿æ¥\n");
            close(client_fd);
            break;
        }
        recv_buf[bytes] = '\0';

        sem_wait(&empty_slots);
        pthread_mutex_lock(&mutex);

        strncpy(message_buffer[in], recv_buf, MAX_MSG_LEN);
        printf("ğŸ“¥ æ¥æ”¶åˆ°æ¶ˆæ¯ -> ç¼“å†²åŒº[%d]: %s", in, message_buffer[in]);
        in = (in + 1) % BUFFER_SIZE;

        pthread_mutex_unlock(&mutex);
        sem_post(&full_slots);
    }

    return NULL;
}

// æ¶ˆè´¹è€…çº¿ç¨‹ï¼šä¸æ–­å¤„ç†æ¶ˆæ¯
void* message_consumer(void* arg) {
    while (1) {
        sem_wait(&full_slots);
        pthread_mutex_lock(&mutex);

        char msg[MAX_MSG_LEN];
        strncpy(msg, message_buffer[out], MAX_MSG_LEN);
        out = (out + 1) % BUFFER_SIZE;

        pthread_mutex_unlock(&mutex);
        sem_post(&empty_slots);

        printf("ğŸ“¤ æ¶ˆè´¹æ¶ˆæ¯ <- ç¼“å†²åŒº: %s", msg);
        // è¿™é‡Œå¯ä»¥æ‰©å±•ä¸ºå†™æ–‡ä»¶ã€å‘é€å“åº”ã€æ—¥å¿—å¤„ç†ç­‰
    }
    return NULL;
}

int main() {
    int server_fd, *client_fd;
    struct sockaddr_in server_addr, client_addr;
    socklen_t client_len = sizeof(client_addr);

    // åˆå§‹åŒ–
    pthread_mutex_init(&mutex, NULL);
    sem_init(&empty_slots, 0, BUFFER_SIZE);
    sem_init(&full_slots, 0, 0);

    // å¯åŠ¨æ¶ˆè´¹è€…çº¿ç¨‹
    pthread_t consumer_tid;
    pthread_create(&consumer_tid, NULL, message_consumer, NULL);

    // å»ºç«‹ socket ç›‘å¬
    server_fd = socket(AF_INET, SOCK_STREAM, 0);
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(PORT);
    server_addr.sin_addr.s_addr = INADDR_ANY;
    bind(server_fd, (struct sockaddr*)&server_addr, sizeof(server_addr));
    listen(server_fd, MAX_CLIENTS);
    printf("ğŸš€ æœåŠ¡å™¨å¯åŠ¨ï¼Œç«¯å£ï¼š%d\n", PORT);

    while (1) {
        client_fd = malloc(sizeof(int));
        *client_fd = accept(server_fd, (struct sockaddr*)&client_addr, &client_len);
        printf("âœ… æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š%s\n", inet_ntoa(client_addr.sin_addr));

        pthread_t tid;
        pthread_create(&tid, NULL, client_handler, client_fd);
        pthread_detach(tid); // å®¢æˆ·ç«¯çº¿ç¨‹è‡ªåŠ¨é‡Šæ”¾èµ„æº
    }

    close(server_fd);
    pthread_mutex_destroy(&mutex);
    sem_destroy(&empty_slots);
    sem_destroy(&full_slots);
    return 0;
}
```

![Alt text](./assets/fa93180c76afb1d2af68426195d758af.png)
